
.MODEL small 

.STACK 100h

.DATA
    msg DB 'B', 0
    crc_l DB 0FFh
    crc_h DB 0FFh
    poly DW 0A001h
.CODE

main PROC
    mov ax, @data
    mov ds, ax

    lea si, msg

next_byte:
    lodsb
    cmp al, 0
    je done

    xor al, crc_l
    mov crc_l, al

    mov cx, 8

bit_loop:
    mov ax, 0         ; ????????? AX
    mov al, crc_l
    mov ah, crc_h
    shr ax, 1         ; ???????? ???? ?????? ?? 1 ???

    jc xor_poly       ; ???? ??? ???????, XOR ?? ???????
    jmp store_crc

xor_poly:
    xor ax, poly

store_crc:
    mov crc_l, al
    mov crc_h, ah

    loop bit_loop
    jmp next_byte

done:
    ; ??? ? crc_h:crc_l ????????? CRC
    ; ????? ??? ???????, ???? ????????
    mov ah, 4Ch
    int 21h
main ENDP
END main
